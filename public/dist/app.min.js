(function(){!function(e){return e.app={}}(this),function(e){var t;return t=JSON.parse(localStorage.getItem("funkollect.io")||"{}"),e.storage={products:m.prop([]),counters:m.prop({all:0}),owned:m.prop(t.owned||[]),need:m.prop(t.need||[]),save:function(){return localStorage.setItem("funkollect.io",JSON.stringify({owned:this.owned(),need:this.need()}))}},m.request({method:"GET",url:"products.json"}).then(function(t){return e.storage.products(t.map(function(t){return e.storage.counters().all++,null==e.storage.counters()[t.license]&&(e.storage.counters()[t.license]={total:0,owned:0,need:0}),e.storage.counters()[t.license].total++,e.storage.owned().indexOf(t.id)>-1&&e.storage.counters()[t.license].owned++,e.storage.need().indexOf(t.id)>-1&&e.storage.counters()[t.license].need++,new e.Product(t)}))})}(this.app),function(e){return e.Product=function(){function t(t){var n,o;for(n in t)o=t[n],this[n]=o;this.owned=m.prop(e.storage.owned().indexOf(this.id)>-1),this.need=m.prop(e.storage.need().indexOf(this.id)>-1)}return t}()}(this.app),function(e){var t;return t=12,e.controller=function(){function n(){this.filter=m.prop(m.route.param("filter")||""),this.counters=e.storage.counters,this.limit=m.prop(t),this.queryInput=m.prop(""),this.query=m.prop(""),window.addEventListener("scroll",function(e){return function(){var n,o,r,i;return n=document.body,i=document.documentElement,r=Math.max(n.scrollHeight,n.offsetHeight,i.clientHeight,i.scrollHeight,i.offsetHeight),n.scrollTop+window.innerHeight>=r-200?(o=e.limit(),e.limit(o+=t),m.redraw(!0)):void 0}}(this),!1)}return n.prototype.products=function(){var t,n,o;return o=this.query(),n=e.storage.products().filter(function(e){return e.title.toLowerCase().indexOf(o.toLowerCase())>-1}),t=this.filter(),"owned"===t?n=n.filter(function(e){return e.owned()===!0}):"need"===t&&(n=n.filter(function(e){return e.need()===!0})),n.slice(0,this.limit())},n.prototype.search=function(){return this.limit(t),this.query(this.queryInput())},n.prototype.need=function(t,n){var o;return o=e.storage.need().indexOf(t.id),n?0>o&&(e.storage.need().push(t.id),e.storage.counters()[t.license].need++):o>-1&&(e.storage.need().splice(o,1),e.storage.counters()[t.license].need--),t.need(n)},n.prototype.owned=function(t,n){var o;return o=e.storage.owned().indexOf(t.id),n?0>o&&(e.storage.owned().push(t.id),e.storage.counters()[t.license].owned++):o>-1&&(e.storage.owned().splice(o,1),e.storage.counters()[t.license].owned--),t.owned(n)},n.prototype.toggleNeed=function(t){return this.need(t,!t.need()),t.need()&&this.owned(t,!1),e.storage.save()},n.prototype.toggleOwned=function(t){return this.owned(t,!t.owned()),t.owned()&&this.need(t,!1),e.storage.save()},n}()}(this.app),function(e){return e.headerView=function(t){return m("header",[m("nav",[m(".logo",[m("span.logo__primary","funko"),m("span.logo__secondary","llect.io")]),m("ul",[m("li",m("a[href=#/]",{className:t.filter()?"":"nav--active"},"#all ("+e.storage.products().length+")")),m("li",m("a[href=#/owned]",{className:"owned"===t.filter()?"nav--active":""},"#owned ("+e.storage.owned().length+")")),m("li",m("a[href=#/need]",{className:"need"===t.filter()?"nav--active":""},"#need ("+e.storage.need().length+")"))])]),m("form",{onsubmit:t.search.bind(t,"ok")},[m('a[href="https://twitter.com/home?status=Have%20fun%20managing%20your%20funko%27s%20funky%20pop%20collection.%20http%3A%2F%2Ffunkollect.io%20via%20%40zh0uzi%20%23funko%20%23collection"][target="_blank"]',"share"),m('a[href="https://twitter.com/home?status=Have%20feedback%3F%20Wanna%20submit%20a%20feature%3F%20Report%20a%20bug%3F%20Get%20in%20touch%20%40zh0uzi"][target="_blank"]',"contact"),m('a[href="https://github.com/Zhouzi/funkollect.io"]',"contribute"),m('input[type="text"][placeholder="Search..."]',{onchange:m.withAttr("value",t.queryInput),value:t.queryInput()}),m('button[type="submit"]',[m('span[class="icon-search"]')])])])}}(this.app),function(e){return e.productsView=function(e){return e.products().map(function(t){return m("article.article",{className:t.owned()?"article--owned":t.need()?"article--need":""},[m("div.article__inner",[m(".article__image",[m("img",{src:"public/images/"+t.id+".png"})]),m(".article__footer",[m("h2",t.name),m("h3",[m("span.article__license",t.license),m("small","("+e.counters()[t.license].owned+"/"+e.counters()[t.license].total+" owned)")]),m("div.article__actions",[m("button",{type:"button",className:t.need()?"button--active":t.owned()?"button--disabled":"",onclick:e.toggleNeed.bind(e,t)},"need"),m("button",{type:"button",className:t.owned()?"button--active":t.need()?"button--disabled":"",onclick:e.toggleOwned.bind(e,t)},"owned")])])])])})}}(this.app),function(e){return e.ownedBlankView=function(e){return m("p","No products, yet.")}}(this.app),function(e){return e.needBlankView=function(e){return m("p","No products, yet.")}}(this.app),function(e){return e.view=function(t){return m("main",[e.headerView(t),m("section",t.products().length?e.productsView(t):"owned"===t.filter()?e.ownedBlankView(t):"need"===t.filter()?e.needBlankView(t):void 0)])}}(this.app),function(e){return m.route.mode="hash",e.router=m.route(document.getElementById("app"),"/",{"/":e,"/:filter":e})}(this.app)}).call(this);