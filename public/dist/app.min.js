(function(){!function(e){return e.app={}}(this),function(e){var t;return t=JSON.parse(localStorage.getItem("funkollect.io")||"{}"),e.storage={products:m.prop([]),counters:m.prop({all:0}),owned:m.prop(t.owned||[]),need:m.prop(t.need||[]),save:function(){return localStorage.setItem("funkollect.io",JSON.stringify({owned:this.owned(),need:this.need()}))}},m.request({method:"GET",url:"products.json"}).then(function(t){return e.storage.products(t.map(function(t){return e.storage.counters().all++,null==e.storage.counters()[t.license]&&(e.storage.counters()[t.license]={total:0,owned:0,need:0}),e.storage.counters()[t.license].total++,e.storage.owned().indexOf(t.id)>-1&&e.storage.counters()[t.license].owned++,e.storage.need().indexOf(t.id)>-1&&e.storage.counters()[t.license].need++,new e.Product(t)}))})}(this.app),function(e){return e.Product=function(){function t(t){var n,r;for(n in t)r=t[n],this[n]=r;this.owned=m.prop(e.storage.owned().indexOf(this.id)>-1),this.need=m.prop(e.storage.need().indexOf(this.id)>-1)}return t}()}(this.app),function(e){var t;return t=12,e.controller=function(){function n(){var n,r,o;this.filter=m.prop(m.route.param("filter")||""),this.counters=e.storage.counters,this.limit=m.prop(t),o=m.route.param("query")||"",n=["name","title","license","category"].indexOf(m.route.param("field"))>-1?m.route.param("field"):"",this.query=m.prop({query:o,field:n}),r=n?n+": "+o:o,this.queryInput=m.prop(r),this.filteredProducts=m.prop(null),this.bindInfiniteScroll()}return n.prototype.bindInfiniteScroll=function(){var e;return e=window.addEventListener("scroll",function(e){return function(){var t,n,r,o;return t=document.body,r=document.documentElement,o=Math.max(t.scrollTop,r.scrollTop)+(r.clientHeight||window.innerHeight),n=Math.max(t.scrollHeight,t.offsetHeight,r.scrollHeight,r.offsetHeight),o>=n-n/6?(e.showMore(),m.redraw(!0)):void 0}}(this),!1),this.onunload=function(){return window.removeEventListener("scroll",e,!1)}},n.prototype.showMore=function(){var e;return e=this.limit(),e<this.products().hits?this.limit(e+=t):void 0},n.prototype.satisfiesQuery=function(e,t,n){return t||(t=this.query().field),n||(n=this.query().query),e[t].toLowerCase().indexOf(n)>-1},n.prototype.products=function(){var t,n,r,o,i;return i=this.query(),o=i.query,t=i.field||"title",r=this.filteredProducts(),null==r&&(r=e.storage.products().filter(function(e){return function(n){return e.satisfiesQuery(n,t,o)}}(this)),n=this.filter(),"owned"===n?r=r.filter(function(e){return e.owned()===!0}):"need"===n&&(r=r.filter(function(e){return e.need()===!0})),this.filteredProducts(r)),{products:r.slice(0,this.limit()),hits:r.length}},n.prototype.search=function(e){var t,n,r,o,i;return e.preventDefault&&e.preventDefault(),i=("string"==typeof e?e:this.queryInput()).split(":"),r=(i.pop()||"").trim().toLowerCase(),t=(i.shift()||"").trim(),"string"==typeof e&&r===this.query().query&&t===this.query().field&&(r="",t=""),n={},r&&(n.query=r),t&&(n.field=t),o="/",this.filter()&&(o+=this.filter()),m.route(o,n),m.redraw.strategy("diff")},n.prototype.getShareUrl=function(){return encodeURIComponent(location.href)},n.prototype.need=function(t,n){var r;return r=e.storage.need().indexOf(t.id),n?0>r&&(e.storage.need().push(t.id),e.storage.counters()[t.license].need++):r>-1&&(e.storage.need().splice(r,1),e.storage.counters()[t.license].need--),t.need(n)},n.prototype.owned=function(t,n){var r;return r=e.storage.owned().indexOf(t.id),n?0>r&&(e.storage.owned().push(t.id),e.storage.counters()[t.license].owned++):r>-1&&(e.storage.owned().splice(r,1),e.storage.counters()[t.license].owned--),t.owned(n)},n.prototype.toggleNeed=function(t){return this.need(t,!t.need()),t.need()&&this.owned(t,!1),e.storage.save()},n.prototype.toggleOwned=function(t){return this.owned(t,!t.owned()),t.owned()&&this.need(t,!1),e.storage.save()},n}()}(this.app),function(e){return e.headerView=function(t){return m("header",[m("nav",[m(".logo",[m("span.logo__primary","funko"),m("span.logo__secondary","llect.io")]),m("ul",[m("li",m("a[href=/]",{config:m.route,className:t.filter()?"":"link--active"},"#all ("+(t.filter()?e.storage.products().length:t.products().hits)+")")),m("li",m("a[href=/owned]",{config:m.route,className:"owned"===t.filter()?"link--active":""},"#owned ("+e.storage.owned().length+")")),m("li",m("a[href=/need]",{config:m.route,className:"need"===t.filter()?"link--active":""},"#need ("+e.storage.need().length+")"))])]),m("form",{onsubmit:t.search.bind(t)},[m('a[href="https://twitter.com/home?status=Have%20fun%20managing%20your%20funko%27s%20funky%20pop%20collection.%20'+t.getShareUrl()+'%20via%20%40zh0uzi%20%23funko%20%23collection"][target="_blank"][class="link--border"]',"share"),m('a[href="https://twitter.com/home?status=Have%20feedback%3F%20Wanna%20submit%20a%20feature%3F%20Report%20a%20bug%3F%20Get%20in%20touch%20%40zh0uzi"][target="_blank"][class="link--border"]',"contact"),m('a[href="https://github.com/Zhouzi/funkollect.io"][class="link--border"]',"contribute"),m('input[type="text"][placeholder="Search..."]',{value:t.queryInput(),onchange:m.withAttr("value",t.queryInput)}),m('button[type="submit"]',[m('span[class="icon-search"]')])])])}}(this.app),function(e){return e.productsView=function(e){var t,n;return t=!!e.query().query,n=function(e,t){var n;return t?void 0:(n=e.getAttribute("src"),e.setAttribute("src",n.replace(/\/s\//g,"/")))},e.products().products.map(function(r){return m("article.article",{key:r.id,className:r.owned()?"article--owned":r.need()?"article--need":""},[m(".article__inner",[m(".article__image",[m(".article__image__mock"),m("img",{config:n,src:"public/images/s/"+r.id+".png"})]),m(".article__footer",[m("h2",r.name),m("h3",[m("a.article__license",{className:t&&e.satisfiesQuery(r,"license")?"article__license--active":"",onclick:e.search.bind(e,"license: "+r.license)},r.license),m("small","("+e.counters()[r.license].owned+"/"+e.counters()[r.license].total+" owned)")]),m("div.article__actions",[m("button",{type:"button",className:r.need()?"button--active":r.owned()?"button--disabled":"",onclick:e.toggleNeed.bind(e,r)},"need"),m("button",{type:"button",className:r.owned()?"button--active":r.need()?"button--disabled":"",onclick:e.toggleOwned.bind(e,r)},"owned")])])])])})}}(this.app),function(e){return e.ownedBlankView=function(e){return m(".block",[m("span","It looks like you don't own any products yet. To find a store, have look at Funko's "),m('a[href="http://funko.com/apps/store-locator"][target="_blank"][class="link--border"]',"store locator"),m("span",".")])}}(this.app),function(e){return e.needBlankView=function(e){return m(".block","Here are listed the products you need. But wait... how can it be empty?")}}(this.app),function(e){return e.noResultsView=function(e){return m(".block","Too bad, there are no results matching your query :/")}}(this.app),function(e){return e.view=function(t){var n;return n=t.products().products.length?e.productsView:"owned"!==t.filter()||e.storage.owned().length?"need"!==t.filter()||e.storage.need().length?e.noResultsView:e.needBlankView:e.ownedBlankView,m("main",[e.headerView(t),m("section",[n(t),t.products().hits>t.limit()?m(".block.link",{onclick:t.showMore.bind(t)},"load more results"):void 0])])}}(this.app),function(e){return m.route.mode="hash",e.router=m.route(document.getElementById("app"),"/",{"/":e,"/:filter":e,"/?field&query":e})}(this.app)}).call(this);